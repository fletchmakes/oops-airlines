pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

-- interpolated value [0.5,1]
local zoom = 1
-- discrete value [0.5,1]
local zoom_target = 1

local originx,originy=-32,-32

function _init()

end

function _update()
    -- write any game update logic here
    if btn(0) then
        originx += 3
    end

    if btn(1) then
        originx -= 3
    end

    if btn(2) then
        originy += 3
    end

    if btn(3) then
        originy -= 3
    end

    -- end game update logic

    if btnp(5) then
        zoom_target = zoom_target == 1 and 0.5 or 1
    end

    zoom = lerp(zoom, zoom_target, 0.2)
end

function lerp(from, to, amount)
    local dist = to - from
    if abs(dist) <= 0.01 then return to end
    return from + (dist * amount)
end

function _draw()
    -- set video mode to 128x128
    poke(0x5f2c, 0)
    -- set the screen to 0x80
    poke(0x5f55, 0x80)

    -- do your game draw operations here as normal
    cls()
    map(0,0,0,0,15,15)
    rectfill(-originx-4,-originy-4,-originx+4,-originy+4,7)
    -- end game draw operations

    -- set video mode to 64x64
    poke(0x5f2c, 3)

    -- set spritesheet to 0x80
    poke(0x5f54, 0x80)
    -- set screen to 0x60
    poke(0x5f55, 0x60)
    cls()
    
    -- draw screen to screen
    -- (originx,originy) is the coordinate center of the zoom. 
    -- (-32,-32) will put the center of the 128x128 canvas on the center of the 64x64 screen.
    local sx = originx * (zoom - 0.5) * 2
    local sy = originy * (zoom - 0.5) * 2
    local sw = 128 * zoom
    local sh = 128 * zoom
    -- treat the screen as a spritesheet when drawing to the screen (thanks video remapping)
    sspr(0, 0, 128, 128, sx, sy, sw, sh)

    -- video remap back to defaults (screen is the screen, spritesheet is the spritesheet)
    poke(0x5f54, 0x00)
end

__gfx__
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0070070088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0007700088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0007700088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0070070088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
0000000088888888888888889999999999999999aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000050605060506050605060506000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000151615161516151615161516000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000050603040304030403040506000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000151613141314131413141516000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000050603040102010203040506000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000151613141112111213141516000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000050603040102010203040506000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000151613141112111213141516000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000050603040304030403040506000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000151613141314131413141516000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000050605060506050605060506000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000151615161516151615161516000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
